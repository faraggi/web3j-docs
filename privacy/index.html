



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation portal for the web3j Blockchain Library">
      
      
        <link rel="canonical" href="https://web3j.io/privacy/">
      
      
        <meta name="author" content="Web3 Labs">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-4.6.3">
    
    
      
        <title>Privacy & Permissioning - Web3j</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.adb8469c.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
      <link rel="manifest" type="application/manifest+json" href="../manifest.webmanifest" crossorigin="use-credentials">
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-85710619-1", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="deep-orange">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#privacy" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://web3j.io/" title="Web3j" aria-label="Web3j" class="md-header-nav__button md-logo">
          
            <img alt="logo" src="../img/logo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Web3j
            </span>
            <span class="md-header-nav__topic">
              
                Privacy & Permissioning
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/web3j/web3j/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    web3j/web3j
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

<nav class="md-tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    </ul>
  </div>
</nav>
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://web3j.io/" title="Web3j" class="md-nav__button md-logo">
      
        <img alt="logo" src="../img/logo.png" width="48" height="48">
      
    </a>
    Web3j
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/web3j/web3j/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    web3j/web3j
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../quickstart/" title="Quickstart" class="md-nav__link">
      Quickstart
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../getting_started/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../modules/" title="Modules" class="md-nav__link">
      Modules
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../transactions/" title="Transactions" class="md-nav__link">
      Transactions
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Privacy & Permissioning
      </label>
    
    <a href="./" title="Privacy & Permissioning" class="md-nav__link md-nav__link--active">
      Privacy & Permissioning
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#privacy-with-hyperledger-besu" class="md-nav__link">
    Privacy with Hyperledger Besu
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#besu-quickstart" class="md-nav__link">
    Besu Quickstart
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#privacy-support-in-web3j" class="md-nav__link">
    Privacy Support in Web3j
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-a-privacy-group" class="md-nav__link">
    Creating a privacy group
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-removing-members" class="md-nav__link">
    Adding &amp; removing members
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-interacting-with-a-smart-contract" class="md-nav__link">
    Creating &amp; interacting with a smart contract
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../smart_contracts/" title="Smart Contracts" class="md-nav__link">
      Smart Contracts
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../application_binary_interface/" title="Application Binary Interface" class="md-nav__link">
      Application Binary Interface
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../recursive_length_prefix/" title="Recursive Length Prefix" class="md-nav__link">
      Recursive Length Prefix
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../filters_and_events/" title="Filters and Events" class="md-nav__link">
      Filters and Events
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../command_line_tools/" title="Command Line Tools" class="md-nav__link">
      Command Line Tools
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../management_apis/" title="Management Apis" class="md-nav__link">
      Management Apis
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../using_infura_with_web3j/" title="Using Infura with Web3j" class="md-nav__link">
      Using Infura with Web3j
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../ethereum_name_service/" title="Ethereum Name Service" class="md-nav__link">
      Ethereum Name Service
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../contracts_supported_by_web3j/" title="Contracts Supported by Web3j" class="md-nav__link">
      Contracts Supported by Web3j
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../embedded_ethereum/" title="Embedded EVM" class="md-nav__link">
      Embedded EVM
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../debugging/" title="Debugging" class="md-nav__link">
      Debugging
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../troubleshooting/" title="Troubleshooting" class="md-nav__link">
      Troubleshooting
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../testing_with_web3j_unit/" title="Testing" class="md-nav__link">
      Testing
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../projects_using_web3j/" title="Projects using Web3j" class="md-nav__link">
      Projects using Web3j
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../companies_using_web3j/" title="Companies using Web3j" class="md-nav__link">
      Companies using Web3j
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../developer_guide/" title="Developer Guide" class="md-nav__link">
      Developer Guide
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../links_and_useful_resources/" title="Links and Useful Resources" class="md-nav__link">
      Links and Useful Resources
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../thanks_and_credits/" title="Thanks and Credits" class="md-nav__link">
      Thanks and Credits
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#privacy-with-hyperledger-besu" class="md-nav__link">
    Privacy with Hyperledger Besu
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#besu-quickstart" class="md-nav__link">
    Besu Quickstart
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#privacy-support-in-web3j" class="md-nav__link">
    Privacy Support in Web3j
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-a-privacy-group" class="md-nav__link">
    Creating a privacy group
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-removing-members" class="md-nav__link">
    Adding &amp; removing members
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-interacting-with-a-smart-contract" class="md-nav__link">
    Creating &amp; interacting with a smart contract
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/web3j/web3j/edit/master/docs/privacy.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="privacy">Privacy<a class="headerlink" href="#privacy" title="Permanent link">&para;</a></h1>
<h2 id="privacy-with-hyperledger-besu">Privacy with Hyperledger Besu<a class="headerlink" href="#privacy-with-hyperledger-besu" title="Permanent link">&para;</a></h2>
<p>The Besu module in Web3j provides support for creating private transactions and privacy groups on Hyperledger Besu. For information as to how privacy is implemented in Besu, please see the <a href="https://besu.hyperledger.org/en/stable/HowTo/Use-Privacy/EEA-Compliant/">Besu privacy documentation</a>. </p>
<p>Privacy in Besu refers to the ability to keep transactions private between the involved participants. Other participants cannot access the transaction content or list of participants. Besu uses Orion, a separate software component, to manage private transactions. Orion is able to maintain public/private keypairs, store privacy group details, and discover other Orion nodes on a network. A privacy group is a group of nodes identified by a unique privacy group ID in Orion. Each private transaction is stored in Orion and is associated with the privacy group ID.</p>
<p>The Besu nodes maintain the public world state for the blockchain and a private state for each privacy group. The private states contain data that is not shared in the globally replicated public world state. </p>
<p>Private transactions have additional attributes to public Ethereum transactions:</p>
<ul>
<li><code>privateFrom</code> - Orion public key of transaction sender</li>
<li><code>privacyGroupId</code> - Privacy group to receive transaction</li>
<li><code>restriction</code> - Private transactions are restricted or unrestricted:<ul>
<li>In restricted private transactions the payload of the private transaction is received and stored only by the nodes participating in the transaction.</li>
<li>In unrestricted private transactions the payload of the private transaction is transmitted to all nodes in the network but is readable only by nodes participating in the transaction.</li>
</ul>
</li>
</ul>
<h2 id="besu-quickstart">Besu Quickstart<a class="headerlink" href="#besu-quickstart" title="Permanent link">&para;</a></h2>
<p>In order to get off the group quickly with Web3j and privacy on Besu, Besu Quickstart should be used. Besu quickstart is a collection of dockerfiles and associated configuration files which allows you to start up a local private-transaction-enabled Ethereum network. In order to get started, ensure you have Docker and Docker Compose installed on your system. Then clone the Besu Quickstart repository likeso:</p>
<div class="codehilite"><pre><span></span><code>git clone https://github.com/PegaSysEng/besu-quickstart.git
</code></pre></div>


<p>In order to start an Ethereum network with privacy enabled, invoke the <code>run-privacy.sh</code> shell script. This should result in a number of containers being started, including 3 Besu nodes which will communicate using the ports <code>localhost:20000-20004</code>. It should be noted that starting the full network generally uses 12GB+ of RAM.</p>
<p>Once the network has been started, the output of the <code>netstat</code> command should indicate that ports 20000-20004 are in use.</p>
<h2 id="privacy-support-in-web3j">Privacy Support in Web3j<a class="headerlink" href="#privacy-support-in-web3j" title="Permanent link">&para;</a></h2>
<p>As mentioned earlier, the Besu module in Web3j can be used to create privacy groups and send private transactions in Besu. The Besu privacy quickstart starts up three nodes with their associated Orion instances, which will henceforth be called Alice, Bob and Charlie for ease of use. The keys associated with each are predetermined, and can be represented in Java as follows:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Credentials</span> <span class="n">ALICE</span> <span class="o">=</span>
        <span class="n">Credentials</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="s">&quot;8f2a55949038a9610f50fb23b5883af3b4ecb3c3bb792cbcefbd1542c692be63&quot;</span><span class="p">);</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Credentials</span> <span class="n">BOB</span> <span class="o">=</span>
        <span class="n">Credentials</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="s">&quot;c87509a1c067bbde78beb793e6fa76530b6382a4c0241e5e4a9ec0a0f44dc0d3&quot;</span><span class="p">);</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Credentials</span> <span class="n">CHARLIE</span> <span class="o">=</span>
        <span class="n">Credentials</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="s">&quot;ae6ae8e5ccbfb04590405997ee2d52d2b330726137b875053c36d94e974d162f&quot;</span><span class="p">);</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Base64String</span> <span class="n">ENCLAVE_KEY_ALICE</span> <span class="o">=</span>
        <span class="n">Base64String</span><span class="p">.</span><span class="na">wrap</span><span class="p">(</span><span class="s">&quot;A1aVtMxLCUHmBVHXoZzzBgPbW/wj5axDpW9X8l91SGo=&quot;</span><span class="p">);</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Base64String</span> <span class="n">ENCLAVE_KEY_BOB</span> <span class="o">=</span>
        <span class="n">Base64String</span><span class="p">.</span><span class="na">wrap</span><span class="p">(</span><span class="s">&quot;Ko2bVqD+nNlNYL5EE7y3IdOnviftjiizpjRt+HTuFBs=&quot;</span><span class="p">);</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Base64String</span> <span class="n">ENCLAVE_KEY_CHARLIE</span> <span class="o">=</span>
        <span class="n">Base64String</span><span class="p">.</span><span class="na">wrap</span><span class="p">(</span><span class="s">&quot;k2zXEin4Ip/qBGlRkJejnGWdP9cjkK+DAvKNW31L2C8=&quot;</span><span class="p">);</span>
</code></pre></div>


<p>The instances of the class <code>Credentials</code> above are the private keys associated with the default account of each Besu node in the network. These are configured in the config files for Besu in the privacy quickstart. The <code>Base64Strings</code> are the Orion keys associated with each member, and are configured in the config files for Orion in the privacy quickstart. If you choose to create your own network, these values will differ from the defaults as specified in the privacy quickstart.</p>
<p>Web3j provides the class <code>org.web3j.protocol.besu.Besu</code> which encapsulates all Besu specific methods with all of the usual Web3j commands. We can use several instances of these to talk to the running quickstart instance:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">private</span> <span class="kd">static</span> <span class="n">Besu</span> <span class="n">nodeAlice</span> <span class="o">=</span> <span class="n">Besu</span><span class="p">.</span><span class="na">build</span><span class="p">(</span><span class="k">new</span> <span class="n">HttpService</span><span class="p">(</span><span class="s">&quot;http://localhost:20000&quot;</span><span class="p">));</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="n">Besu</span> <span class="n">nodeBob</span> <span class="o">=</span> <span class="n">Besu</span><span class="p">.</span><span class="na">build</span><span class="p">(</span><span class="k">new</span> <span class="n">HttpService</span><span class="p">(</span><span class="s">&quot;http://localhost:20002&quot;</span><span class="p">));</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="n">Besu</span> <span class="n">nodeCharlie</span> <span class="o">=</span> <span class="n">Besu</span><span class="p">.</span><span class="na">build</span><span class="p">(</span><span class="k">new</span> <span class="n">HttpService</span><span class="p">(</span><span class="s">&quot;http://localhost:20004&quot;</span><span class="p">));</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="n">PollingPrivateTransactionReceiptProcessor</span> <span class="n">processor</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PollingPrivateTransactionReceiptProcessor</span><span class="p">(</span><span class="n">nodeAlice</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">15</span><span class="p">);</span>
</code></pre></div>


<h3 id="creating-a-privacy-group">Creating a privacy group<a class="headerlink" href="#creating-a-privacy-group" title="Permanent link">&para;</a></h3>
<p>In order to create a new privacy group, first a random 32 byte base64 string is generated to form the group ID. Then the create group function is called, and we wait for the transaction receipt to be returned. Finally, we can call the <code>privOnChainFindPrivacyGroup</code> method, which will find the privacy group which was just created by using the two Orion keys of the group members. </p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Generate a new random Base64 string for the privacy group ID</span>
<span class="n">Base64String</span> <span class="n">privacyGroupId</span> <span class="o">=</span> <span class="n">Base64String</span><span class="p">.</span><span class="na">wrap</span><span class="p">(</span><span class="n">generateRandomBytes</span><span class="p">(</span><span class="mi">32</span><span class="p">));</span>

<span class="c1">// Create the privacy group</span>
<span class="kd">final</span> <span class="n">String</span> <span class="n">txHash</span> <span class="o">=</span>
        <span class="n">nodeAlice</span>
                <span class="p">.</span><span class="na">privOnChainCreatePrivacyGroup</span><span class="p">(</span>
                        <span class="n">privacyGroupId</span><span class="p">,</span>
                        <span class="n">ALICE</span><span class="p">,</span>
                        <span class="n">ENCLAVE_KEY_ALICE</span><span class="p">,</span>
                        <span class="n">Collections</span><span class="p">.</span><span class="na">singletonList</span><span class="p">(</span><span class="n">ENCLAVE_KEY_BOB</span><span class="p">))</span>
                <span class="p">.</span><span class="na">send</span><span class="p">()</span>
                <span class="p">.</span><span class="na">getTransactionHash</span><span class="p">();</span>

<span class="c1">// Wait for the transaction to be mined &amp; get the receipt</span>
<span class="n">TransactionReceipt</span> <span class="n">receipt</span> <span class="o">=</span> <span class="n">processor</span><span class="p">.</span><span class="na">waitForTransactionReceipt</span><span class="p">(</span><span class="n">txHash</span><span class="p">);</span>

<span class="c1">// Find the privacy group based on the two members</span>
<span class="n">Optional</span><span class="o">&lt;</span><span class="n">PrivacyGroup</span><span class="o">&gt;</span> <span class="n">group</span> <span class="o">=</span>
        <span class="n">nodeAlice</span>
                <span class="p">.</span><span class="na">privOnChainFindPrivacyGroup</span><span class="p">(</span>
                        <span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="n">ENCLAVE_KEY_ALICE</span><span class="p">,</span> <span class="n">ENCLAVE_KEY_BOB</span><span class="p">))</span>
                <span class="p">.</span><span class="na">send</span><span class="p">()</span>
                <span class="p">.</span><span class="na">getGroups</span><span class="p">().</span><span class="na">stream</span><span class="p">().</span><span class="na">filter</span><span class="p">(</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span><span class="p">.</span><span class="na">getPrivacyGroupId</span><span class="p">().</span><span class="na">equals</span><span class="p">(</span><span class="n">privacyGroupId</span><span class="p">)).</span><span class="na">findFirst</span><span class="p">();</span>
</code></pre></div>


<h3 id="adding-removing-members">Adding &amp; removing members<a class="headerlink" href="#adding-removing-members" title="Permanent link">&para;</a></h3>
<p>After a privacy group has been created, users can be added to the group using the <code>privOnChainAddToPrivacyGroup</code> method, and removed from the group using the <code>privOnChainRemoveFromPrivacyGroup</code> method.</p>
<div class="codehilite"><pre><span></span><code><span class="n">Base64String</span> <span class="n">privacyGroupId</span> <span class="o">=</span> <span class="n">Base64String</span><span class="p">.</span><span class="na">wrap</span><span class="p">(</span><span class="n">generateRandomBytes</span><span class="p">(</span><span class="mi">32</span><span class="p">));</span>
<span class="kd">final</span> <span class="n">String</span> <span class="n">createTxHash</span> <span class="o">=</span>
        <span class="n">nodeAlice</span>
                <span class="p">.</span><span class="na">privOnChainCreatePrivacyGroup</span><span class="p">(</span>
                        <span class="n">privacyGroupId</span><span class="p">,</span>
                        <span class="n">ALICE</span><span class="p">,</span>
                        <span class="n">ENCLAVE_KEY_ALICE</span><span class="p">,</span>
                        <span class="n">Collections</span><span class="p">.</span><span class="na">singletonList</span><span class="p">(</span><span class="n">ENCLAVE_KEY_BOB</span><span class="p">))</span>
                <span class="p">.</span><span class="na">send</span><span class="p">()</span>
                <span class="p">.</span><span class="na">getTransactionHash</span><span class="p">();</span>

<span class="n">TransactionReceipt</span> <span class="n">createReceipt</span> <span class="o">=</span> <span class="n">processor</span><span class="p">.</span><span class="na">waitForTransactionReceipt</span><span class="p">(</span><span class="n">createTxHash</span><span class="p">);</span>

<span class="c1">// Once the group has been created, add Charlie from Alice&#39;s node</span>
<span class="kd">final</span> <span class="n">String</span> <span class="n">addTxHash</span> <span class="o">=</span>
        <span class="n">nodeAlice</span>
                <span class="p">.</span><span class="na">privOnChainAddToPrivacyGroup</span><span class="p">(</span>
                        <span class="n">privacyGroupId</span><span class="p">,</span>
                        <span class="n">ALICE</span><span class="p">,</span>
                        <span class="n">ENCLAVE_KEY_ALICE</span><span class="p">,</span>
                        <span class="n">Collections</span><span class="p">.</span><span class="na">singletonList</span><span class="p">(</span><span class="n">ENCLAVE_KEY_CHARLIE</span><span class="p">))</span>
                <span class="p">.</span><span class="na">send</span><span class="p">()</span>
                <span class="p">.</span><span class="na">getTransactionHash</span><span class="p">();</span>

<span class="n">TransactionReceipt</span> <span class="n">addReceipt</span> <span class="o">=</span> <span class="n">processor</span><span class="p">.</span><span class="na">waitForTransactionReceipt</span><span class="p">(</span><span class="n">addTxHash</span><span class="p">);</span>

<span class="c1">// Once the add transaction has been mined, find the privacy group which contains Alice, Bob &amp; Charlie</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">PrivacyGroup</span><span class="o">&gt;</span> <span class="n">groups</span> <span class="o">=</span>
        <span class="n">nodeAlice</span>
                <span class="p">.</span><span class="na">privOnChainFindPrivacyGroup</span><span class="p">(</span>
                        <span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span>
                                <span class="n">ENCLAVE_KEY_ALICE</span><span class="p">,</span> <span class="n">ENCLAVE_KEY_BOB</span><span class="p">,</span> <span class="n">ENCLAVE_KEY_CHARLIE</span><span class="p">))</span>
                <span class="p">.</span><span class="na">send</span><span class="p">()</span>
                <span class="p">.</span><span class="na">getGroups</span><span class="p">();</span>

<span class="c1">// Remove Charlie from the privacy group</span>
<span class="kd">final</span> <span class="n">String</span> <span class="n">removeTxHash</span> <span class="o">=</span>
        <span class="n">nodeAlice</span>
                <span class="p">.</span><span class="na">privOnChainRemoveFromPrivacyGroup</span><span class="p">(</span>
                        <span class="n">privacyGroupId</span><span class="p">,</span> <span class="n">ALICE</span><span class="p">,</span> <span class="n">ENCLAVE_KEY_ALICE</span><span class="p">,</span> <span class="n">ENCLAVE_KEY_CHARLIE</span><span class="p">)</span>
                <span class="p">.</span><span class="na">send</span><span class="p">()</span>
                <span class="p">.</span><span class="na">getTransactionHash</span><span class="p">();</span>

<span class="n">TransactionReceipt</span> <span class="n">removeReceipt</span> <span class="o">=</span> <span class="n">processor</span><span class="p">.</span><span class="na">waitForTransactionReceipt</span><span class="p">(</span><span class="n">removeTxHash</span><span class="p">);</span>

<span class="c1">// Get the privacy group with only Alice and Bob now in it.</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">PrivacyGroup</span><span class="o">&gt;</span> <span class="n">removedGroups</span> <span class="o">=</span>
        <span class="n">nodeAlice</span>
                <span class="p">.</span><span class="na">privOnChainFindPrivacyGroup</span><span class="p">(</span>
                        <span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="n">ENCLAVE_KEY_ALICE</span><span class="p">,</span> <span class="n">ENCLAVE_KEY_BOB</span><span class="p">))</span>
                <span class="p">.</span><span class="na">send</span><span class="p">()</span>
                <span class="p">.</span><span class="na">getGroups</span><span class="p">();</span>
</code></pre></div>


<h3 id="creating-interacting-with-a-smart-contract">Creating &amp; interacting with a smart contract<a class="headerlink" href="#creating-interacting-with-a-smart-contract" title="Permanent link">&para;</a></h3>
<p>Once a privacy group has been created, smart contracts can be created &amp; executed within the privacy group. The state of the contract and all of the associated transactions will only be viewable to those within the privacy group. In this example, an instance of a <code>HumanStandardToken</code> is deployed within the group, and is visible to each member:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Create a new privacy group</span>
<span class="n">Base64String</span> <span class="n">aliceBobGroup</span> <span class="o">=</span> <span class="n">Base64String</span><span class="p">.</span><span class="na">wrap</span><span class="p">(</span><span class="n">generateRandomBytes</span><span class="p">(</span><span class="mi">32</span><span class="p">));</span>
<span class="kd">final</span> <span class="n">String</span> <span class="n">createTxHash</span> <span class="o">=</span>
        <span class="n">nodeAlice</span>
                <span class="p">.</span><span class="na">privOnChainCreatePrivacyGroup</span><span class="p">(</span>
                        <span class="n">aliceBobGroup</span><span class="p">,</span>
                        <span class="n">ALICE</span><span class="p">,</span>
                        <span class="n">ENCLAVE_KEY_ALICE</span><span class="p">,</span>
                        <span class="n">Collections</span><span class="p">.</span><span class="na">singletonList</span><span class="p">(</span><span class="n">ENCLAVE_KEY_BOB</span><span class="p">))</span>
                <span class="p">.</span><span class="na">send</span><span class="p">()</span>
                <span class="p">.</span><span class="na">getTransactionHash</span><span class="p">();</span>

<span class="n">TransactionReceipt</span> <span class="n">createReceipt</span> <span class="o">=</span> <span class="n">processor</span><span class="p">.</span><span class="na">waitForTransactionReceipt</span><span class="p">(</span><span class="n">createTxHash</span><span class="p">);</span>

<span class="c1">// Find the privacy group that was built by Alice from Bob&#39;s node</span>
<span class="kd">final</span> <span class="n">Base64String</span> <span class="n">aliceBobGroupFromBobNode</span> <span class="o">=</span>
        <span class="n">nodeBob</span>
                <span class="p">.</span><span class="na">privOnChainFindPrivacyGroup</span><span class="p">(</span>
                        <span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="n">ENCLAVE_KEY_ALICE</span><span class="p">,</span> <span class="n">ENCLAVE_KEY_BOB</span><span class="p">))</span>
                <span class="p">.</span><span class="na">send</span><span class="p">().</span><span class="na">getGroups</span><span class="p">().</span><span class="na">stream</span><span class="p">()</span>
                <span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">g</span> <span class="o">-&gt;</span> <span class="n">g</span><span class="p">.</span><span class="na">getPrivacyGroupId</span><span class="p">().</span><span class="na">equals</span><span class="p">(</span><span class="n">aliceBobGroup</span><span class="p">))</span>
                <span class="p">.</span><span class="na">findFirst</span><span class="p">()</span>
                <span class="p">.</span><span class="na">orElseThrow</span><span class="p">(</span><span class="n">RuntimeException</span><span class="p">::</span><span class="k">new</span><span class="p">)</span>
                <span class="p">.</span><span class="na">getPrivacyGroupId</span><span class="p">();</span>

<span class="c1">// Create two private transaction manager instances for Alice and Bob in order to interact with smart contracts</span>
<span class="kd">final</span> <span class="n">PrivateTransactionManager</span> <span class="n">tmAlice</span> <span class="o">=</span>
        <span class="k">new</span> <span class="n">BesuPrivateTransactionManager</span><span class="p">(</span>
                <span class="n">nodeAlice</span><span class="p">,</span>
                <span class="n">ZERO_GAS_PROVIDER</span><span class="p">,</span>
                <span class="n">ALICE</span><span class="p">,</span>
                <span class="mi">2018</span><span class="p">,</span>
                <span class="n">ENCLAVE_KEY_ALICE</span><span class="p">,</span>
                <span class="n">aliceBobGroup</span><span class="p">);</span>
<span class="kd">final</span> <span class="n">PrivateTransactionManager</span> <span class="n">tmBob</span> <span class="o">=</span>
        <span class="k">new</span> <span class="n">BesuPrivateTransactionManager</span><span class="p">(</span>
                <span class="n">nodeBob</span><span class="p">,</span>
                <span class="n">ZERO_GAS_PROVIDER</span><span class="p">,</span>
                <span class="n">BOB</span><span class="p">,</span>
                <span class="mi">2018</span><span class="p">,</span>
                <span class="n">ENCLAVE_KEY_BOB</span><span class="p">,</span>
                <span class="n">aliceBobGroupFromBobNode</span><span class="p">);</span>

<span class="c1">// Deploy the token from Alice&#39;s node</span>
<span class="kd">final</span> <span class="n">HumanStandardToken</span> <span class="n">tokenAlice</span> <span class="o">=</span>
        <span class="n">HumanStandardToken</span><span class="p">.</span><span class="na">deploy</span><span class="p">(</span>
                        <span class="n">nodeAlice</span><span class="p">,</span>
                        <span class="n">tmAlice</span><span class="p">,</span>
                        <span class="n">ZERO_GAS_PROVIDER</span><span class="p">,</span>
                        <span class="n">BigInteger</span><span class="p">.</span><span class="na">TEN</span><span class="p">,</span>
                        <span class="s">&quot;eea_token&quot;</span><span class="p">,</span>
                        <span class="n">BigInteger</span><span class="p">.</span><span class="na">TEN</span><span class="p">,</span>
                        <span class="s">&quot;EEATKN&quot;</span><span class="p">)</span>
                <span class="p">.</span><span class="na">send</span><span class="p">();</span>

<span class="c1">// Get an instance of the token from Bob&#39;s node</span>
<span class="kd">final</span> <span class="n">HumanStandardToken</span> <span class="n">tokenBob</span> <span class="o">=</span>
        <span class="n">HumanStandardToken</span><span class="p">.</span><span class="na">load</span><span class="p">(</span>
                <span class="n">tokenAlice</span><span class="p">.</span><span class="na">getContractAddress</span><span class="p">(),</span> <span class="n">nodeBob</span><span class="p">,</span> <span class="n">tmBob</span><span class="p">,</span> <span class="n">ZERO_GAS_PROVIDER</span><span class="p">);</span>
</code></pre></div>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../transactions/" title="Transactions" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Transactions
              </span>
            </div>
          </a>
        
        
          <a href="../smart_contracts/" title="Smart Contracts" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Smart Contracts
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2017-2019 Web3 Labs Ltd
          </div>
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/web3j" target="_blank" rel="noopener" title="github" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/web3labs" target="_blank" rel="noopener" title="twitter" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://linkedin.com/in/web3labs" target="_blank" rel="noopener" title="linkedin" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.1",url:{base:".."}})</script>
      
    
  </body>
</html>